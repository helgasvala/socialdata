<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <style type="text/css">
            button {
            margin: 0 auto;
            background-color:#EEF7D7;
            -moz-border-radius:8px;
            -webkit-border-radius:8px;
            border-radius:8px;
            border:1px solid #939788;
            display:inline-block;
            cursor:pointer;
            color:#000000;
            font-size:16px;
            font-weight:bold;
            padding:6px 24px;
            text-decoration:none;
        }

        .textContainer {
            background-color: white;
            -moz-border-radius:8px;
            color:#000000;
            font-size:16px;
            font-weight:bold;
            padding:6px 24px;
            text-decoration:none;
        }

    </style>

    </head>
    <body>

        <button id="03" class="toggleButton"> 2003 </button>
        <button id="15" class="toggleButton"> 2015 </button>
   
            <script type="text/javascript">
            d3.csv("DataSF.csv", function(data) {
                console.log(data);

            data.forEach(function(d) {
                 d.total03 = +d.total03;
                 d.vTheft03 = +d.vTheft03;
                 d.prost03= +d.prost03;

                 d.total15 = +d.total15;
                 d.vTheft15 = +d.vTheft15;
                 d.prost15= +d.prost15;
            });

              // Let´s define Width and height
            var w = 1000;
            var h = 700;
            var padding = 75; //staðsetur ásana

            var scaleR = d3.scale.linear()
                 .domain([0, d3.max(data, function(d) {return d['total15']/2+d['total03']/2;})])
                 .range([1,20]);
            var scaleX = d3.scale.linear()
                .domain([0, Math.max(d3.max(data, function(d) {return d['prost03']; }))])
                .range([padding, w-padding * 2]);
            var scaleY = d3.scale.linear()
                 .domain([0, d3.max(data, function(d) {return d['vTheft03']; })])
                 .range([h-padding, padding]);

              //Create SVG element
            var svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

            // Create axis function
            var xAxis = d3.svg.axis()
                .scale(scaleX)
                .orient("bottom")
                .ticks(10);

            var yAxis = d3.svg.axis()
                .scale(scaleY)
                .orient("left")
                .ticks(10);


            function createCircles(year) {
             //Create the circles
                svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    
                    //Let´s load in the dots
                    .attr("fill", "rgba(0, 255, 700, 0.75)")
                    .attr("stroke", "rgba(0, 255, 0, 0.25)")
                    .attr("stroke-width", "5")
                    .attr("cx", function(d) {return scaleX(d['prost'+year]);})
                    .attr("cy", function(d) {return scaleY(d['vTheft'+year]);})
                    .attr("r", function(d)  {return scaleR(d['total'+year]);}); 
                
            }

            //function createText(year) {
                       //Let´s load in the district to appear for each point
                svg.selectAll("text")
                    .data(data)
                    .enter()
                    .append("text")
                    .text(function(d) {
                    return d['PdDistrict'];
                        })
                    .attr("x", function(d) {
                        return scaleX(d['prost03']+22);
                        })
                    .attr("y", function(d) {
                        return scaleY(d['vTheft03']);
                        })

                   .attr("font-family", "sans-serif")
                   .attr("font-size", "13px")
                   .attr("fill", "black");
               }


                svg.append("text")      // text label for the x axis
                        .attr("x", w/2 )
                        .attr("y",  h-5 )
                        .style("text-anchor", "middle")
                        .text("Number of prostitution crimes");



                svg.append("text")
                            .style("text-anchor", "middle")  
                            .attr("transform", "translate("+ (14) +","+(h/2)+")rotate(-90)") 
                            .text("Number of vehicle thefts");


                //Let´s create the axis
                //x-axis
             svg.append("g")
                . attr("class", "axis")
                . attr("transform", "translate(0," + (h-padding) + ")")
                .call(xAxis);
                //y-axis
            svg.append("g")
                . attr("class", "axis")
                . attr("transform", "translate(" + padding + ",0)")
                .call(yAxis);


                //let´s put label on the axis

                d3.selectAll(".toggleButton").on("click", function(){
                buttonID = d3.select(this).attr("id")
                createCircles(buttonID)
                createText(buttonID)
                console.log(buttonID)
                // 
                });


            });
        </script>
    </body>
</html>
